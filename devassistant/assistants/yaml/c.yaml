c:
  fullname: C Language Tool

  dependencies:
  - default:
    - rpm: ['gcc', 'gcc-c++','glibc-devel', 'automake', 'autoconf','valgrind','gdb','ddd','strace']
  - _build:
    - rpm: ['rpm-build','mock','eclipse-rpm-editor']
  - _eclipse:
    - rpm: ['eclipse-mylyn-context-cdt','eclipse-egit','eclipse-cdt','eclipse-cdt-parsers','eclipse-cdt-sdk']
  - _idesettings:
    - rpm: ['vim', 'gvim']

  args:
    name:
      flags:
      - -n
      - --name
      help:
        'Name of project to create'

    build:
      flags:
      - -b
      - --build
      help:
        'This will create SRPM and RPM packages. Specify distribution which you want to use like fedora fedora-19-i386'

    #idesettings:
    #  flags:
    #  - -i
    #  - --idesettings
    #  help:
    #    'This will install editors'

    eclipse:
      flags:
      - -e
      - --eclipse
      help:
        'Specify Eclipse workspage directory where project will be stored'
      action:
        [default_iff_used, ~/workspace]
      nargs:
        '?'

    github:
      flags:
      - -g
      - --github
      help:
        'This will create a Git Hub repository according to the project name and push your source there.'
      nargs:
        '?'

  files:
    csources: &csources
      source: c/
    specfile: &specfile
      source: c/cdevelopmenttool.spec

  run:
  - log_i: 'Copying c source tree to project destination'
  - if not ls $name:
    - cl: cp -r *csources $name
    - dda_c: $name
    - cl: cd $name
    - cl: git init
    - cl: git add .
    - cl: git commit -m "initial_commit"
  - else:
    - cl: cd $name
  - log_i: 'Run autoreconf'
  - cl_f: autoreconf --install
  - log_i: 'Run configure script'
  - cl_f: ./configure
  - log_i: 'Compilation sources'
  - cl_f: make
  - log_i: 'Calling make distcheck for creating tar ball'
  - cl_f: make distcheck # will create distribution tar ball for later on usage
  - if $eclipse:
    - log_i: 'Creating eclipse project from command line'
    - cl: cd ..
    - cl: mkdir -p $eclipse/$name
    - if ls $name/.eclipseproject:
      - log_i: 'Project was not imported to eclipse environment yet'
      - cl: sed -i s|<name>cdevelassistant<|<name>$name<| $name/.eclipseproject
      - cl: mv $name/.eclipseproject $name/.project
      - cl: cp $name/.project $eclipse/$name/.project
      - cl: cp $name/.cproject $eclipse/$name/.cproject
      - cl: cp $name/.autotools $eclipse/$name/.autotools
      - log_i: 'Copying neccessary files was done'
    - else:
      - log_i: 'Project was already imported into eclipse environment'
    - cl: eclipse -nosplash -application org.eclipse.cdt.managedbuilder.core.headlessbuild -import ./$name -data $eclipse
    - log_i: 'Import to Eclipse is done.'
    - log_i: 'Start eclipse for developping.'
  - if defined $github:
    - log_i: 'Creating repository on GitHub'
    - github: create_repo
    - log_i: 'Checking status of local git'
    - cl_f: git status
    - log_i: 'Push local git respository on GitHub'
    - github: push
  - if $build:
    - log_i: 'Creating spec file'
    - cl: rpmdev-setuptree
    - cl: rm -f ~/rpmbuild/SPECS/*
    - cl: cp cdevelopmenttool-1.0.tar.gz ~/rpmbuild/SOURCES
    - cl: cp *specfile ~/rpmbuild/SPECS
    - cl: cd ~/rpmbuild/SPECS
    - cl_f: sudo yum-builddep ~/rpmbuild/SPECS/cdevelopmenttool.spec
    - log_i: 'Creating RPM from tarball'
    - cl_f: rpmbuild -ba cdevelopmenttool.spec
    - log_i: 'Creating RPM from SRPM over mock'
    - cl_f: rpmbuild -bs cdevelopmenttool.spec
    - cl_f: mock -r $build ~/rpmbuild/SRPMS/cdevelopmenttool-1.0-0.src.rpm
